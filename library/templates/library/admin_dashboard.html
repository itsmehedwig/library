{% extends 'library/base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4 md:mb-8"><i class="fas fa-tachometer-alt mr-2 md:mr-3 text-blue-600"></i>Admin Dashboard</h1>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8">
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-blue-100">Total Students</p>
                <p class="text-3xl font-bold">{{ total_students }}</p>
            </div>
            <i class="fas fa-users text-4xl opacity-50"></i>
        </div>
    </div>
    
    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-green-100">Total Books</p>
                <p class="text-3xl font-bold">{{ total_books }}</p>
            </div>
            <i class="fas fa-book text-4xl opacity-50"></i>
        </div>
    </div>
    
    <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-yellow-100">Currently Borrowed</p>
                <p class="text-3xl font-bold">{{ total_borrowed }}</p>
            </div>
            <i class="fas fa-book-reader text-4xl opacity-50"></i>
        </div>
    </div>

</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-cogs mr-2 text-blue-600"></i>Quick Actions</h2>
        <div class="space-y-3">
            {% if pending_registrations > 0 %}
            <a href="{% url 'pending_students' %}" class="block bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-4 py-3 rounded-lg transition border-2 border-yellow-500">
                <i class="fas fa-user-clock mr-2"></i>Pending Registrations <span class="bg-yellow-500 text-white px-2 py-1 rounded-full text-xs ml-2">{{ pending_registrations }}</span>
            </a>
            {% endif %}
            {% if pending_borrowing > 0 %}
            <a href="{% url 'pending_transactions' %}" class="block bg-orange-100 hover:bg-orange-200 text-orange-800 px-4 py-3 rounded-lg transition border-2 border-orange-500">
                <i class="fas fa-book-medical mr-2"></i>Pending Book Borrowing <span class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs ml-2">{{ pending_borrowing }}</span>
            </a>
            {% endif %}
            <a href="{% url 'import_students_csv' %}" class="block bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-3 rounded-lg transition">
                <i class="fas fa-file-import mr-2"></i>Import Students from CSV
            </a>
            <a href="{% url 'import_books_csv' %}" class="block bg-teal-100 hover:bg-teal-200 text-teal-800 px-4 py-3 rounded-lg transition">
                <i class="fas fa-file-upload mr-2"></i>Import Books from CSV
            </a>
            <a href="{% url 'add_book' %}" class="block bg-green-100 hover:bg-green-200 text-green-800 px-4 py-3 rounded-lg transition">
                <i class="fas fa-plus mr-2"></i>Add New Book
            </a>
            <a href="{% url 'create_pos_account' %}" class="block bg-purple-100 hover:bg-purple-200 text-purple-800 px-4 py-3 rounded-lg transition">
                <i class="fas fa-user-plus mr-2"></i>Create POS Account
            </a>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-history mr-2 text-green-600"></i>Recent Transactions</h2>
        <div class="space-y-4">
            {% for transaction in recent_transactions|dictsortreversed:"borrowed_date" %}
    {% if transaction.status != 'returned' %}
        <div class="border-l-4 border-blue-600 bg-blue-50 p-3 rounded-r">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <p class="font-semibold text-gray-800">{{ transaction.transaction_code }}</p>
                    <p class="text-sm text-gray-600">{{ transaction.student.get_full_name }} ({{ transaction.student.student_id }})</p>
                </div>
                <span class="text-xs px-2 py-1 rounded bg-blue-200 text-blue-800">
                    {{ transaction.status|title }}
                </span>
            </div>
            <div class="text-xs text-gray-600 mb-2">
                <i class="fas fa-calendar-alt mr-1"></i>Borrowed: {{ transaction.borrowed_date|date:"Y-m-d H:i" }}
            </div>
            <div class="mt-2">
                <p class="text-xs font-semibold text-gray-700 mb-1">Books:</p>
                {% for item in transaction.items.all %}
                    {% if item.status != 'returned' %}
                        <div class="text-xs pl-2 mb-1 text-blue-700">
                            <i class="fas fa-book mr-1"></i>{{ item.book.title }}
                            <span class="text-blue-600">(Borrowed: {{ item.borrowed_date|date:"Y-m-d H:i" }})</span>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% empty %}
    <p class="text-gray-500">No recent transactions</p>
{% endfor %}

{% endblock %}
